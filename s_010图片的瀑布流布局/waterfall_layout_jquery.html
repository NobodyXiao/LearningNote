<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
	<style type="text/css">
		/*#main{
			-webkit-column-width:199px;
			-moz-column-width:199px;
			-o-column-width:199px;
			-ms-column-width:199px;
		}*/

	    *{padding: 0;margin:0;}
	    #main{
	        position: relative;
	    }
	    .box{
	        padding: 0 0 15px 15px;
	        float:left;
	    }
	    .pic{
	        padding: 10px;
	        border:1px solid #ccc;
	        box-shadow: 0 0 6px #ccc;
	        border-radius: 5px;
	    }
	    .box img{
	        width:162px;
	        height:auto;
	    }
	</style>

	<script>
		$(window).on("load",function() {
			waterfall();
			$(window).on("resize",waterfall);
			var dataimage={"images":[{'src':'image/data/26.jpg'},
								{'src':'image/data/27.jpeg'},
								{'src':'image/data/28.jpg'},
								{'src':'image/data/29.jpg'},
								{'src':'image/data/30.jpg'},
								{'src':'image/data/31.jpeg'},
								{'src':'image/data/32.jpg'},
								{'src':'image/data/33.jpg'},
								{'src':'image/data/34.jpg'},
								{'src':'image/data/35.jpg'},
								{'src':'image/data/36.jpg'},
								{'src':'image/data/37.jpg'},
								{'src':'image/data/38.jpg'},
								{'src':'image/data/39.jpg'},
								{'src':'image/data/40.jpg'},
								{'src':'image/data/41.jpg'},
								{'src':'image/data/42.jpg'},
								{'src':'image/data/43.jpg'},
								{'src':'image/data/44.jpg'},
								{'src':'image/data/45.jpg'},
								{'src':'image/data/46.jpg'},
								{'src':'image/data/47.jpg'},
								{'src':'image/data/48.jpg'},
								{'src':'image/data/49.jpg'},
								{'src':'image/data/50.jpg'},
								{'src':'image/data/51.jpg'},
								]};
			$(window).on("scroll",function(){
				//判断是否具备了加载的条件
				if(check()){
					$.each(dataimage.images,function(key,value){
						var appendbox = $("<div>").addClass("box").appendTo($("#main"));
						var appendpic = $("<div>").addClass("pic").appendTo($(appendbox));
						$("<img>").attr("src",$(value).attr("src")).appendTo($(appendpic));
						console.log($(value).attr('src'));
						
					})
					waterfall();
				}
			});
			

		})
	function waterfall(){
		var windowWidth = $(window).width();
		$boxs = $("#main>div");
		$pics = $(".pic");
		var boxw = $boxs.eq(0).outerWidth();
		var cols =Math.floor(windowWidth/boxw);
		//$("#main").width(boxw*cols).css("margin","0 auto"); 
		var picH = [];
		$boxs.each(function(index,value){
			var h = $boxs.eq(index).outerHeight();
			
			if(index < cols){
				picH[index] = h;
			}
			else{
				var minH = Math.min.apply(null,picH);
				var minHIndex = $.inArray(minH,picH);
				$(value).css({
					"position":"absolute",
					"top":minH+'px',
					"left":minHIndex*boxw+"px"
				})
				picH[minHIndex] += $boxs.eq(index).outerHeight();
			}
			
			
		})
	}
	function check(){
		var $lastbox = $("#main > div").last();
		var lastBoxDis = $lastbox.offset().top + Math.floor($lastbox.outerHeight()/2);
		var windowScroll = $(window).scrollTop();
		var documentH = $(document).height();
		return (lastBoxDis < windowScroll+documentH)?true:false;
	}
</script>
	
</head>

<body>
<div id="main">
<div class="box">
	<div class="pic">
		<img src="image/1.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/2.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/3.png" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/4.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/5.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/6.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/7.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/8.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/9.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/10.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/11.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/12.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/13.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/14.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/15.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/16.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/17.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/18.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/19.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/20.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/21.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/22.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/23.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/24.jpg" alt="">
	</div>
</div>
<div class="box">
	<div class="pic">
		<img src="image/25.jpg" alt="">
	</div>
</div>	
</div>
	

</body>
</html>